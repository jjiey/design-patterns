## 访问者模式（行为型）

Visitor Design Pattern

访问者模式允许一个或者多个操作应用到一组对象上，设计意图是解耦操作和对象本身，保持类职责单一、满足开闭原则以及应对代码的复杂性。

Single Dispatch：执行哪个对象的方法，根据对象的运行时类型来决定；执行对象的哪个方法，根据方法参数的【编译时】类型来决定
Double Dispatch：执行哪个对象的方法，根据对象的运行时类型来决定；执行对象的哪个方法，根据方法参数的【运行时】类型来决定。

### 定义

在 GoF 的《设计模式》一书中，它是这么定义的：

> Allows for one or more operation to be applied to a set of objects at runtime, decoupling the operations from the object structure.

翻译：允许一个或者多个操作应用到一组对象上，解耦操作和对象本身。

### 解决问题

### 应用场景举例

假设我们从网站上爬取了很多资源文件，它们的格式有三种：PDF、PPT、Word。现在要开发一个工具来处理这批资源文件：把这些资源文件中的文本内容抽取出来放到 txt 文件中 demo2 v1/v2/v3
工具的功能不停地扩展，不仅要能抽取文本内容，还要支持压缩、提取文件元信息（文件名、大小、更新时间等等）、构建索引等一系列的功能 demo2 v4/v5

### code

demo1：大话设计模式

demo2：应用场景
v1：硬写
v2：编译不过
v3：add class Extractor
v4：加功能 add class Compressor
v5：真正的访问者模式

一般来说，访问者模式针对的是一组类型不同的对象（PdfFile、PPTFile、WordFile）。
不过，尽管这组对象的类型是不同的，但是，它们继承相同的父类（ResourceFile）或者实现相同的接口。
在不同的应用场景下，我们需要对这组对象进行一系列不相关的业务操作（抽取文本、压缩等），
但为了避免不断添加功能导致类（PdfFile、PPTFile、WordFile）不断膨胀，职责越来越不单一，以及避免频繁地添加功能导致的频繁代码修改，
我们使用访问者模式，**将对象与操作解耦**，将这些业务操作抽离出来，定义在独立细分的访问者类（Extractor、Compressor）中。

v6：用工厂模式来实现（类很多，如果功能比较少（比如只有一两个功能）可以用，如果功能很多还是推荐使用访问者模式）

------

表示一个作用于某对象结构中的各元素的操作。它使你可以在不改变各元素的类的前提下定义作用于这些元素的新操作。